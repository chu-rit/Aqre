<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=portrait">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="screen-orientation" content="portrait">
    <meta name="mobile-web-app-capable" content="yes">
    
    <script>
        // í™”ë©´ íšŒì „ ê°ì§€ ë° ì²˜ë¦¬
        function handleOrientation() {
            if (window.orientation === 90 || window.orientation === -90) {
                document.body.style.opacity = '0';
                alert('ì´ ê²Œì„ì€ ì„¸ë¡œ ëª¨ë“œì—ì„œë§Œ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní™”ë©´ì„ ì„¸ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”.');
            } else {
                document.body.style.opacity = '1';
            }
        }

        // í™”ë©´ íšŒì „ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('orientationchange', handleOrientation);
        window.addEventListener('load', handleOrientation);
        
        // ë² ì´ìŠ¤ URL ì„¤ì •
        const BASE_URL = location.hostname === 'chu-rit.github.io' ? '/Aqre' : '';
        
        // ë™ì ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ì„¤ì •
        function setResourcePaths() {
            const resources = document.querySelectorAll('link[data-dynamic-path], script[data-dynamic-path]');
            resources.forEach(resource => {
                const path = resource.getAttribute('href') || resource.getAttribute('src');
                if (resource.getAttribute('href')) {
                    resource.setAttribute('href', `${BASE_URL}${path}`);
                } else {
                    resource.setAttribute('src', `${BASE_URL}${path}`);
                }
            });
        }
    </script>
    
    <link rel="manifest" href="manifest.json" data-dynamic-path>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png" data-dynamic-path>
    <link rel="icon" href="icons/icon-192x192.png" data-dynamic-path>
    <link rel="stylesheet" href="styles.css" data-dynamic-path>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <title>Aqre Puzzle Game</title>
</head>
<body>
    <div id="messageContainer" class="message-container"></div>

    <div class="start-screen" id="startScreen">
        <h1>AQRE</h1>
        <p id="appVersion" class="app-version"></p>
        <div class="button-container">
            <button id="startButton" class="game-button">ê²Œì„ ì‹œì‘</button>
            <button id="optionsButton" class="game-button">ì˜µì…˜</button>
        </div>
    </div>

    <div class="level-screen" id="levelScreen" style="display: none;">
        <div class="screen-header">
            <button id="backToStart" class="back-button"><</button>
            <h1>ë ˆë²¨ ì„ íƒ</h1>
        </div>
        <div class="level-container">
            <div id="basicLevelGrid" class="level-grid">
                <!-- Basic levels (1-5) will be added here -->
            </div>
            <div id="advancedLevelGrid" class="level-grid">
                <!-- Advanced levels will be added here -->
            </div>
        </div>
    </div>

    <div class="game-screen" id="gameScreen" style="display: none;">
        <div class="container">
            <div class="game-header">
                <button id="backToLevels" class="back-button"><</button>
                <h1>AQRE</h1>
                <div id="currentLevelDisplayInGame" class="current-level">Level 1</div>
                <button id="refreshLevel" class="refreshLevel">â†»</button>
            </div>
            <div class="game-content">
                <div id="gameBoard" class="game-board"></div>
            </div>
            <div id="game-container">
                <div id="board"></div> 
                <div id="rule-violations">
                    <h3>ê·œì¹™ ìœ„ë°˜</h3>
                    <ul id="violation-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ë£° íŒì—… -->
    <div id="rulesPopup" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2>ê²Œì„ ê·œì¹™</h2>
                <button id="closeRules" class="close-button">&times;</button>
            </div>
            <div class="rules">
                <ul>
                    <li>ì–´ëŠ ë°©í–¥ìœ¼ë¡œë“  ê°™ì€ ìƒ‰ìƒì˜ ë¸”ëŸ­ì´ 4ê°œ ì—°ì†ë˜ì§€ ì•Šë„ë¡ í•˜ì„¸ìš”.</li>
                    <li>ìƒ‰ì¹ í•œ ë¸”ëŸ­ì€ ëŒ€ê°ì„ ì„ ì œì™¸í•˜ê³  ê°€ë¡œë“  ì„¸ë¡œë“  ì—°ê²°ë˜ì–´ ìˆë„ë¡ í•˜ì„¸ìš”.</li>
                    <li>êµµì€ìƒ‰ìœ¼ë¡œ êµ¬ë¶„ëœ ì˜ì—­ì•ˆì— ìˆ«ìì— ë§ëŠ” ìˆ˜ì˜ ë¸”ëŸ­ë§Œ ìƒ‰ì¹ í•˜ì„¸ìš”.</li>
                    <li>ìˆ«ìê°€ ì—†ëŠ” ì˜ì—­ì€ ê°¯ìˆ˜ ì œí•œì€ ì—†ìŠµë‹ˆë‹¤.</li>
                </ul>
            </div>
        </div>
    </div>
    

    <!-- ê²Œì„ í´ë¦¬ì–´ íŒì—… -->
    <div id="gameClearPopup" class="popup game-clear-popup" style="display:none;">
        <div class="popup-content">
            <div class="popup-header">
                <h2>ğŸ‰ ë ˆë²¨ í´ë¦¬ì–´!</h2>
            </div>
            <div class="popup-body">
                <p id="gameClearMessage">ì¶•í•˜í•©ë‹ˆë‹¤! ë ˆë²¨ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.</p>
                <div class="game-stats">
                    <p>ì›€ì§ì„: <span id="clearMoves">0</span></p>
                </div>
            </div>
            <div class="popup-footer">
                <button id="backToLevelsButton" class="game-button">ìƒˆë ˆë²¨ ì„ íƒ</button>
            </div>
        </div>
    </div>

    <script src="puzzles.js" data-dynamic-path></script>
    <script src="script.js" data-dynamic-path></script>
    <script>
        // PWA Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(`${BASE_URL}/service-worker.js`)
                    .then((registration) => {
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch((error) => {
                        console.error('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        }
    </script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ì„¤ì •
        window.addEventListener('DOMContentLoaded', setResourcePaths);
    </script>
</body>
</html>
